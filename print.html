<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The DarkFi Book</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">DarkFi</a></li><li class="chapter-item expanded "><a href="development.html"><strong aria-hidden="true">1.</strong> Development</a></li><li class="chapter-item expanded "><a href="tutorial.html"><strong aria-hidden="true">2.</strong> Tutorial</a></li><li class="chapter-item expanded "><a href="clients/clients.html"><strong aria-hidden="true">3.</strong> Client</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="clients/jsonrpc.html"><strong aria-hidden="true">3.1.</strong> JSONRPC API</a></li></ol></li><li class="chapter-item expanded "><a href="zkas/zkas.html"><strong aria-hidden="true">4.</strong> zkas</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="zkas/examples.html"><strong aria-hidden="true">4.1.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="zkas/examples/sapling.html"><strong aria-hidden="true">4.1.1.</strong> Sapling payment scheme</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The DarkFi Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="darkfi"><a class="header" href="#darkfi">DarkFi</a></h1>
<p><img src="https://github.com/darkrenaissance/darkfi/actions/workflows/ci.yml/badge.svg" alt="Build Status" />
<a href="https://dark.fi"><img src="https://img.shields.io/badge/Web-dark.fi-white?logo=firefox&amp;logoColor=white" alt="Web - dark.fi" /></a>
<a href="https://lists.dyne.org/lurker/message/20211021.123016.3dccaf0c.en.html"><img src="https://img.shields.io/badge/Manifesto-unsystem-informational?logo=minutemailer&amp;logoColor=white" alt="Manifesto - unsystem" /></a>
<a href="https://darkrenaissance.github.io/darkfi"><img src="https://img.shields.io/badge/Book-mdbook-orange?logo=gitbook&amp;logoColor=white" alt="Book - mdbook" /></a></p>
<h2 id="build"><a class="header" href="#build">Build</a></h2>
<h4 id="note-use-the-v001-git-tag-if-you-want-to-try-out-the-software"><a class="header" href="#note-use-the-v001-git-tag-if-you-want-to-try-out-the-software">NOTE: Use the v0.0.1 git tag if you want to try out the software.</a></h4>
<p>This project requires the Rust compiler to be installed. 
Please visit https://rustup.rs/ for instructions.</p>
<p>The following dependencies are also required:</p>
<table><thead><tr><th>Dependency</th><th>Debian-based</th></tr></thead><tbody>
<tr><td>gcc, gcc-c++, kernel headers</td><td>build-essential</td></tr>
<tr><td>clang</td><td>clang</td></tr>
<tr><td>clang libs</td><td>libclang-dev</td></tr>
<tr><td>llvm libs</td><td>llvm-dev</td></tr>
<tr><td>udev libs</td><td>libudev-dev</td></tr>
<tr><td>pkg-config</td><td>pkg-config</td></tr>
<tr><td>wget</td><td>wget</td></tr>
</tbody></table>
<p>Users of Debian-based systems (e.g. Ubuntu) can simply run the following 
to install the required dependencies:</p>
<pre><code class="language-shell">% sudo apt-get update
% sudo apt-get install -y build-essential clang libclang-dev llvm-dev \
    libudev-dev pkg-config wget
</code></pre>
<p>To build the necessary binaries, we can just clone the repo, and use the 
provided Makefile to build the project. This will download the trusted 
setup params, and compile the source code.</p>
<pre><code class="language-shell">% git clone https://github.com/darkrenaissance/darkfi
% cd darkfi/
% make
</code></pre>
<h2 id="development"><a class="header" href="#development">Development</a></h2>
<p>If you want to hack on the source code, make sure to read some
introductory advice in the
<a href="https://darkrenaissance.github.io/darkfi/development.html">DarkFi book</a>.</p>
<h2 id="install"><a class="header" href="#install">Install</a></h2>
<p>This will install the binaries and configurations in the configured
namespace (<code>/usr/local</code> by default). The configurations are installed
as TOML files in <code>/usr/local/share/doc/darkfi</code>. They have to be copied
in your user's <code>HOME/.config/darkfi</code> directory. You can review the
installed config files, but the defaults should be good for using
the testnet if you're following this document.</p>
<pre><code class="language-shell">% sudo make install
% mkdir -p ~/.config/darkfi
% cp -f /usr/local/share/doc/darkfi/*.toml ~/.config/darkfi
</code></pre>
<p>N.B. On OSX this is <code>/Users/x/Library/Application Support/darkfi</code>.</p>
<h2 id="bash-completion"><a class="header" href="#bash-completion">Bash Completion</a></h2>
<p>This will add the options auto completion of <code>drk</code> and <code>darkfid</code>.</p>
<pre><code class="language-shell">% echo source (pwd)/contrib/auto-complete &gt;&gt; ~/.bashrc
</code></pre>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>After the installation, you should have <code>drk</code> and <code>darkfid</code>
binaries in <code>/usr/local</code>. Also, the configuration files should be in
<code>~/.config/darkfi</code>. Now we're ready to use the testnet.</p>
<p>In one terminal, start <code>darkfid</code>, which is the daemon that will
communicate with the DarkFi network:</p>
<pre><code class="language-shell">% darkfid -v
</code></pre>
<p>And in the other terminal, we can use the CLI interface to <code>darkfid</code>
called <code>drk</code>:</p>
<pre><code class="language-shell">% drk -h

USAGE:
    drk [FLAGS] [OPTIONS] [SUBCOMMAND]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information
    -v, --verbose    Increase verbosity

OPTIONS:
    -c, --config &lt;CONFIG&gt;    Sets a custom config file

SUBCOMMANDS:
    deposit     Deposit clear tokens for Dark tokens
    features    Show what features the cashier supports
    hello       Say hello to the RPC
    help        Prints this message or the help of the given subcommand(s)
    id          Get hexidecimal ID for token symbol
    transfer    Transfer Dark tokens to address
    wallet      Wallet operations
    withdraw    Withdraw Dark tokens for clear tokens
</code></pre>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<p>See the <a href="https://darkrenaissance.github.io/darkfi">DarkFi book</a></p>
<h2 id="go-dark"><a class="header" href="#go-dark">Go Dark</a></h2>
<p>Let's liberate people from the claws of big tech and create the
democratic paradigm of technology.</p>
<p>Self-defense is integral to any organism's survival and growth.</p>
<p>Power to the minuteman.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="notes-for-developers"><a class="header" href="#notes-for-developers">Notes for developers</a></h1>
<h2 id="cargo-fmt-pre-commit-hook"><a class="header" href="#cargo-fmt-pre-commit-hook">cargo fmt pre-commit hook</a></h2>
<p>To ensure every contributor uses the same code style, make sure
you run <code>cargo fmt</code> before committing. You can force yourself to do
this by creating a git <code>pre-commit</code> hook like the following:</p>
<pre><code class="language-shell">#!/bin/sh
if ! cargo +nightly fmt -- --check &gt;/dev/null; then
    echo &quot;There are some code style issues. Run 'cargo fmt' to fix it.&quot;
    exit 1
fi

exit 0
</code></pre>
<p>Place this script in <code>.git/hooks/pre-commit</code> and make sure it's
executable by running <code>chmod +x .git/hooks/pre-commit</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="darkfi-user-tutorial"><a class="header" href="#darkfi-user-tutorial">DarkFi User Tutorial</a></h1>
<p>Welcome to the dark renaissance. This tutorial will teach you how to
install darkfi on your system, and how to use the testnet to send and
receive anonymous tokens.</p>
<h2 id="download"><a class="header" href="#download">Download</a></h2>
<p>To run darkfi, we must first install the software. Do this by cloning
the darkfi repo:</p>
<pre><code>% git clone https://github.com/darkrenaissance/darkfi
</code></pre>
<h2 id="build-1"><a class="header" href="#build-1">Build</a></h2>
<p>In the project root directory, run provided Makefile. This will download
the trusted setup params and compile the source code. This might take
a while.</p>
<pre><code>% make
</code></pre>
<h2 id="install-1"><a class="header" href="#install-1">Install</a></h2>
<p>We will now install the project. This will install the binaries
and configurations in the configured namespace (<code>/usr/local</code>
by default). The configurations are installed as TOML files in
<code>/usr/local/share/doc/darkfi</code>. They have to be copied in your user's
<code>HOME/.config/darkfi</code> directory.</p>
<p>Feel free to review the installed config files, but you don't need to
change anything to run the testnet. The defaults will work fine.</p>
<pre><code>% sudo make install
% mkdir -p ~/.config/darkfi
% cp -f /usr/local/share/doc/darkfi/*.toml ~/.config/darkfi
</code></pre>
<h2 id="run"><a class="header" href="#run">Run</a></h2>
<p>Darkfi consists of several software daemons or processes. These daemons
have seperate, isolated concerns.</p>
<p>As a user, your interest is in the <code>darkfid</code> daemon. This is a user
node that interacts with your wallet and communicates with services on
the darkfi network. It is operated using the <code>drk</code> command-line tool.</p>
<p>After the installation, you should have <code>drk</code> and <code>darkfid</code> binaries in
<code>/usr/local</code>. Also, the params and configuration files should be in
<code>~/.config/darkfi</code>.</p>
<p>We're now ready to use the testnet.</p>
<p>Open two terminal windows. In one terminal, start <code>darkfid</code>:</p>
<pre><code>% darkfid -v
</code></pre>
<p>And another terminal, run <code>drk</code>. This is the command-line interface to
interact with <code>darkfid</code>.</p>
<pre><code>% drk -h
drk

USAGE:
    drk [FLAGS] [OPTIONS] [SUBCOMMAND]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information
    -v, --verbose    Increase verbosity

OPTIONS:
    -c, --config &lt;CONFIG&gt;    Sets a custom config file

SUBCOMMANDS:
    deposit     Deposit clear tokens for Dark tokens
    features    Show what features the cashier supports
    hello       Say hello to the RPC
    help        Prints this message or the help of the given subcommand(s)
    id          Get hexidecimal ID for token symbol
    transfer    Transfer Dark tokens to address
    wallet      Wallet operations
    withdraw    Withdraw Dark tokens for clear tokens
</code></pre>
<h2 id="deposit"><a class="header" href="#deposit">Deposit</a></h2>
<p>We'll go through the main features one by one. Let's start by depositing
some coins into darkfi.</p>
<p>First, we need testnet coins on either Bitcoin or Solana. For
Bitcoin these can be acquired from a faucet like <a href="https://testnet-faucet.mempool.co/">this
one</a>. You will need to switch your
Bitcoin wallet to testnet mode.</p>
<p>If you don't have a Bitcoin wallet, <a href="https://electrum.org/">Electrum</a>
is an excellent option. Configuring Electrum
for testnet depends on the operating system: see <a href="https://bitzuma.com/posts/a-beginners-guide-to-the-electrum-bitcoin-wallet/#testnet-on-ubuntu">this
tutorial</a>
for more details.</p>
<p>For Solana, you can either install the Solana command-line suite or use
<a href="sollet.io">sollet</a>.</p>
<p>Follow <a href="https://docs.solana.com/cli">this tutorial</a> for the Solana
command-line. For sollet.io, switch the network to testnet and click
'Request Airdrop' to airdrop yourself some testnet coins.</p>
<p>Now that we have testnet coins we can deposit into darkfi.</p>
<p>We'll do this by sending testnet coins to the darki cashier, which will
issue darkened versions of the deposted coin. This process of darkening
involves the cashier minting new anonymous tokens that are 1:1 redeemable
for deposits. For example, if you deposit 1 BTC, you will receive 1 dBTC,
or darkened SOL.</p>
<p>To deposit testnet BTC:</p>
<pre><code>% drk deposit btc --network bitcoin
</code></pre>
<p>To deposit testnet SOL:</p>
<pre><code>% drk deposit sol --network solana
</code></pre>
<p>To deposit any other asset:</p>
<pre><code>% drk deposit [ASSET] --network solana
</code></pre>
<p>This command will send a deposit request to the cashier. After running
it, you should get an address printed to your terminal, like this:</p>
<pre><code>Deposit your coins to the following address: &quot;734JBp3FRPoDs6ibSMyq3CV9zyMiDeynxMQRbSxVvozN&quot;
</code></pre>
<p>Using Bitcoin or Solana, deposit the desired tokens to the specified
address. Wait a moment- it should take about 30 seconds to receive your
deposit. You can follow the progress on the terminal window where you ran
<code>darkfid</code>. Then check your updated balance, like so:</p>
<pre><code>% drk wallet --balances

+-------+--------+---------+
| token | amount | network |
+-------+--------+---------+
| SOL   | 1      | solana  |
+-------+--------+---------+

</code></pre>
<h2 id="send"><a class="header" href="#send">Send</a></h2>
<p>Now that you have darkened tokens inside darkfi, you can send them
around anonymously.</p>
<p>Find a friend with an account on darkfi and ask them for their darkfi
address. Then run the transfer command:</p>
<pre><code>% drk transfer &lt;TOKEN&gt; &lt;ADDRESS&gt; &lt;AMOUNT&gt;
</code></pre>
<p>For example, to transfer 1 SOL to a user at
9GmLk7kkbxhsbLTYFMeg6FyuQJV9Na2GcJYFNrs3VLkv address, you would run the
following command:</p>
<pre><code>% drk transfer sol 9GmLk7kkbxhsbLTYFMeg6FyuQJV9Na2GcJYFNrs3VLkv 1
</code></pre>
<h2 id="receive"><a class="header" href="#receive">Receive</a></h2>
<p>To receive anonymous tokens your darkfid account, you must retrieve your
darkfi address. Send this address to others so they can send you tokens.</p>
<pre><code>% drk wallet --address
Wallet address: &quot;9GmLk7kkbxhsbLTYFMeg6FyuQJV9Na2GcJYFNrs3VLkv&quot;
</code></pre>
<h2 id="withdraw"><a class="header" href="#withdraw">Withdraw</a></h2>
<p>Withdrawing your testnet funds can be done at any time. This will exchange
your anonymous darkened tokens for their underlying collaterol, i.e. if
you have 1 dBTC you will receive 1 BTC.</p>
<p>To do so, simply send the following request to the cashier:</p>
<pre><code>% drk withdraw &lt;TOKENSYM&gt; &lt;ADDRESS&gt; &lt;AMOUNT&gt; --network &lt;network&gt;
</code></pre>
<p>For example, if you want to withdraw 0.5 SOL to the Solana address
4q7rkNvH5BVs6VLz6nyhKLvqXmwDyjGnUsE5sZzRNgp4, you would write:</p>
<pre><code>% drk withdraw sol 4q7rkNvH5BVs6VLz6nyhKLvqXmwDyjGnUsE5sZzRNgp4 0.5 --network solana
</code></pre>
<p>For Bitcoin, the command would look like this:</p>
<pre><code>% drk withdraw btc bc1qw7nt2yca0zykh8a5sc6nmy3r3clx4ha206wepn 0.5 --network bitcoin
</code></pre>
<h2 id="configure"><a class="header" href="#configure">Configure</a></h2>
<p>DarkFi is highly configurable by design. Key system parameters can be
changed inside the config files.</p>
<p>This is the darkfid config file. Your local copy can be found in
<code>~/.config/darkfi</code>.</p>
<pre><code class="language-toml">## darkfid configuration file
##
## Please make sure you go through all the settings so you can configure
## your daemon properly.

# The address where darkfid should bind its RPC socket
rpc_listen_address = &quot;127.0.0.1:8000&quot;

# Whether to listen with TLS or plain TCP
serve_tls = false

# Path to DER-formatted PKCS#12 archive. (Unused if serve_tls=false)
# This can be created using openssl:
# openssl pkcs12 -export -out identity.pfx -inkey key.pem -in cert.pem -certfile chain_certs.pem
tls_identity_path = &quot;~/.config/darkfi/darkfid_identity.pfx&quot;

# Password for the created TLS identity. (Unused if serve_tls=false)
tls_identity_password = &quot;FOOBAR&quot;

# The endpoint to a gatewayd protocol API
gateway_protocol_url = &quot;tcp://185.165.171.77:3333&quot;

# The endpoint to a gatewayd publisher API
gateway_publisher_url = &quot;tcp://185.165.171.77:4444&quot;

# Path to mint.params
mint_params_path = &quot;~/.config/darkfi/mint.params&quot;

# Path to spend.params
spend_params_path = &quot;~/.config/darkfi/spend.params&quot;

# Path to the client database
database_path = &quot;~/.config/darkfi/darkfid_client.db&quot;

# Path to the wallet database
wallet_path = &quot;~/.config/darkfi/darkfid_wallet.db&quot;

# The wallet password
wallet_password = &quot;TEST_PASSWORD&quot;

# The configured cashiers to use.
[[cashiers]]

# Cashier name
name = &quot;testnet.cashier.dark.fi&quot;

# The RPC endpoint for a selected cashier
#rpc_url = &quot;tcp://127.0.0.1:9000&quot;
rpc_url = &quot;tcp://185.165.171.77:9000&quot;

# The selected cashier public key
public_key = &quot;2MezH7FrtzGwtEEeTU8anM2b67Nzfv8XsojggGUavCUd&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="clients"><a class="header" href="#clients">Clients</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="jsonrpc-api"><a class="header" href="#jsonrpc-api">JSONRPC API</a></h1>
<h2 id="methods"><a class="header" href="#methods">Methods</a></h2>
<ul>
<li><a href="clients/jsonrpc.html#say_hello">say_hello</a></li>
<li><a href="clients/jsonrpc.html#create_wallet">create_wallet</a></li>
<li><a href="clients/jsonrpc.html#key_gen">key_gen</a></li>
<li><a href="clients/jsonrpc.html#get_key">get_key</a></li>
<li><a href="clients/jsonrpc.html#get_keys">get_keys</a></li>
<li><a href="clients/jsonrpc.html#import_keypair">import_keypair</a></li>
<li><a href="clients/jsonrpc.html#export_keypair">export_keypair</a></li>
<li><a href="clients/jsonrpc.html#set_default_address">set_default_address</a></li>
<li><a href="clients/jsonrpc.html#get_balances">get_balances</a></li>
<li><a href="clients/jsonrpc.html#get_token_id">get_token_id</a></li>
<li><a href="clients/jsonrpc.html#features">features</a></li>
<li><a href="clients/jsonrpc.html#deposit">deposit</a></li>
<li><a href="clients/jsonrpc.html#withdraw">withdraw</a></li>
<li><a href="clients/jsonrpc.html#transfer">transfer</a></li>
</ul>
<h3 id="say_hello"><a class="header" href="#say_hello">say_hello:</a></h3>
<p><code>params</code>: []</p>
<p><code>result</code>: &quot;helloworld&quot;</p>
<h3 id="create_wallet"><a class="header" href="#create_wallet">create_wallet:</a></h3>
<p><code>params</code>: []</p>
<p><code>result</code>: true</p>
<h3 id="key_gen"><a class="header" href="#key_gen">key_gen:</a></h3>
<p><code>params</code>: []</p>
<p><code>result</code>: true</p>
<h3 id="get_key"><a class="header" href="#get_key">get_key:</a></h3>
<p><code>params</code>: []</p>
<p><code>result</code>: &quot;vdNS7oBj7KvsMWWmo9r96SV4SqATLrGsH2a3PGpCfJC&quot;</p>
<h3 id="get_keys"><a class="header" href="#get_keys">get_keys:</a></h3>
<p><code>params</code>: []</p>
<p><code>result</code>: &quot;[vdNS7oBj7KvsMWWmo9r96SV4SqATLrGsH2a3PGpCfJC, ...]&quot;</p>
<blockquote>
<p><code>note</code>:  the first address in the returned vector is the default address</p>
</blockquote>
<h3 id="import_keypair"><a class="header" href="#import_keypair">import_keypair:</a></h3>
<p><code>params</code>: [path]</p>
<p><code>result</code>: true</p>
<h3 id="export_keypair"><a class="header" href="#export_keypair">export_keypair:</a></h3>
<p><code>params</code>: [path]</p>
<p><code>result</code>: true</p>
<h3 id="set_default_address"><a class="header" href="#set_default_address">set_default_address:</a></h3>
<p><code>params</code>: [vdNS7oBj7KvsMWWmo9r96SV4SqATLrGsH2a3PGpCfJC]</p>
<p><code>result</code>: true</p>
<h3 id="get_balances"><a class="header" href="#get_balances">get_balances:</a></h3>
<p><code>params</code>: []</p>
<p><code>result</code>: &quot;[{&quot;btc&quot;:(value, network)}, ...]&quot;</p>
<h3 id="get_token_id"><a class="header" href="#get_token_id">get_token_id:</a></h3>
<p><code>params</code>: [network, token]</p>
<p><code>result</code>: &quot;Ht5G1RhkcKnpLVLMhqJc5aqZ4wYUEbxbtZwGCVbgU7DL&quot;</p>
<h3 id="features"><a class="header" href="#features">features:</a></h3>
<p><code>params</code>: []</p>
<p><code>result</code>: {&quot;network&quot;:[&quot;btc&quot;, &quot;sol&quot;]}</p>
<h3 id="deposit-1"><a class="header" href="#deposit-1">deposit:</a></h3>
<p><code>params</code>: [network, token, publickey]</p>
<p><code>result</code>: &quot;Ht5G1RhkcKnpLVLMhqJc5aqZ4wYUEbxbtZwGCVbgU7DL&quot;</p>
<blockquote>
<p><code>note</code>:  The publickey sent here is used so the cashier can know where to send
tokens once the deposit is received.</p>
</blockquote>
<h3 id="withdraw-1"><a class="header" href="#withdraw-1">withdraw:</a></h3>
<p><code>params</code>: [network, token, publickey, amount]</p>
<p><code>result</code>: &quot;txID&quot;</p>
<blockquote>
<p><code>note</code>:  The publickey sent here is the address where the caller wants to receive
the tokens they plan to withdraw.
On request, send request to cashier to get deposit address, and then transfer
dark tokens to the cashier's wallet. Following that, the cashier should return
a transaction ID of them sending the funds that are requested for withdrawal.</p>
</blockquote>
<h3 id="transfer"><a class="header" href="#transfer">transfer:</a></h3>
<p><code>params</code>: [network, dToken, address, amount]</p>
<p><code>result</code>: &quot;txID&quot;</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="zkas"><a class="header" href="#zkas">zkas</a></h1>
<p>zkas is a compiler for the Halo2 zkVM langage used in
<a href="https://github.com/darkrenaissance/darkfi">DarkFi</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="examples-1"><a class="header" href="#examples-1">Examples</a></h1>
<p>This section holds practical and real-world examples of the use for
zkas.</p>
<ul>
<li><a href="zkas/examples/sapling.html">Sapling payment scheme</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="sapling-payment-scheme"><a class="header" href="#sapling-payment-scheme">Sapling payment scheme</a></h1>
<p>Generally, the Sapling payment scheme consists of two proofs -
<strong>mint</strong> and <strong>burn</strong>. We use the mint proof to create a new <em>coin</em>
<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>, and we use the burn proof to spend a previously minted <em>coin</em>.</p>
<h2 id="mint"><a class="header" href="#mint">Mint</a></h2>
<pre><code>constant &quot;Mint&quot; {
	EcFixedPoint VALUE_COMMIT_VALUE,
	EcFixedPoint VALUE_COMMIT_RANDOM,
}

contract &quot;Mint&quot; {
	Base pub_x,
	Base pub_y,
	Base value,
	Base token,
	Base serial,
	Base coin_blind,
	Scalar value_blind,
	Scalar token_blind,
}

circuit &quot;Mint&quot; {
	# Poseidon hash of the coin
	C = poseidon_hash(pub_x, pub_y, value, token, serial, coin_blind);
	constrain_instance(C);

	# Pedersen commitment for coin's value
	vcv = ec_mul_short(value, VALUE_COMMIT_VALUE);
	vcr = ec_mul(value_blind, VALUE_COMMIT_RANDOM);
	value_commit = ec_add(vcv, vcr);
	# Since the value commit is a curve point, we fetch its coordinates
	# and constrain them:
	value_commit_x = ec_get_x(value_commit);
	value_commit_y = ec_get_y(value_commit);
	constrain_instance(value_commit_x);
	constrain_instance(value_commit_y);

	# Pedersen commitment for coin's token ID
	tcv = ec_mul_short(token, VALUE_COMMIT_VALUE);
	tcr = ec_mul(token_blind, VALUE_COMMIT_RANDOM);
	token_commit = ec_add(tcv, tcr);
	# Since token_commit is also a curve point, we'll do the same
	# coordinate dance:
	token_commit_x = ec_get_x(token_commit);
	token_commit_y = ec_get_y(token_commit);
	constrain_instance(token_commit_x);
	constrain_instance(token_commit_y);

	# At this point we've enforced all of our public inputs.
}
</code></pre>
<p>As you can see, the <code>Mint</code> contract/circuit basically consists of
three operations. First one is hashing the <em>coin</em> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>, and after
that, we create <em>Pedersen commitments</em> for both the coin's <strong>value</strong>
and the coin's <strong>token ID</strong>. On top of the zkas code, we've declared
two constant values that we are going to use for multiplication in
the commitments.</p>
<p>The <code>constrain_instance</code> call can take any of our assigned variables
and enforce a <em>public input</em>. Public inputs are an array (or vector)
of values used as public inputs by verifiers to verify a zero knowledge
proof. In the above case of the Mint contract, since we have five
calls to <code>constrain_instance</code>, we would also have an array of five
elements that represent these public inputs. The array's order <strong>must</strong>
match the <code>constrain_instance</code> calls since they will be constrained
by their index in the array (which is incremented for every call).</p>
<p>In other words, the vector of public inputs could look like this:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let public_inputs = vec![
    coin,
    *value_commitment_coords.x(),
    *value_commitment_coords.y(),
    *token_commitment_coords.x(),
    *token_commitment_coords.y(),
];
<span class="boring">}
</span></code></pre></pre>
<p>And then the Verifier uses these public inputs to verify a given zero 
knowledge proof.</p>
<h3 id="coin"><a class="header" href="#coin">Coin</a></h3>
<p>During the <strong>Mint</strong> phase we create a new coin <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>, which is bound
to the public key <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>. The coin <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> is publicly revealed on the
blockchain and added to the Merkle tree.</p>
<p>Let <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> be the coin's value, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> be the token ID, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ρ</span></span></span></span> be the unique
serial number for the coin, and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> be a random blinding value. We
create a commitment (hash) these elements and produce the coin <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> in
zero-knowledge:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">ρ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<h3 id="value-and-token-commitments"><a class="header" href="#value-and-token-commitments">Value and Token commitments</a></h3>
<p>To have some value <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> for our coin, we can create a
<em>Pedersen commitment</em> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> where <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the blinding factor for the
commitment, and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are two predefined generators:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></span>
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>The token ID can be thought of as an attribute we append to our <em>coin</em>
so we can have a differentiation of assets we are working with. In
practice for example, this allows us to work with different tokens,
using the same zero-knowledge proof circuit. For this token ID, we can
also build a <em>Pedersen commitment</em> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>, where <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> is the token ID,
<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the blinding factor, and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are the generators:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>Knowing this, we can extend our code example and build the
before-mentioned public inputs for the circuit:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let public_key = pallas::Point::random(&amp;mut OsRng);
let coords = public_key.to_affine().coordinates().unwrap();
let pub_x = *coords.x();
let pub_y = *coords.y();

let value = pallas::Base::from(42);
let token = pallas::Base::from(1);
let serial = pallas::Base::random(&amp;mut OsRng);
let coin_blind = pallas::Base::random(&amp;mut OsRng);

let coin = poseidon::Hash(pub_x, pub_y, value, token, serial, coin_blind);

let value_commit = pedersen_commitment_u64(value, value_blind);
let value_coords = value_commit.to_affine().coordinates().unwrap();

let token_commit = pedersen_commitment_u64(token, token_blind);
let token_coords = token_commit.to_affine().coordinates().unwrap();

let public_inputs = vec![
    coin,
    *value_commitment_coords.x(),
    *value_commitment_coords.y(),
    *token_commitment_coords.x(),
    *token_commitment_coords.y(),
];
<span class="boring">}
</span></code></pre></pre>
<h2 id="burn"><a class="header" href="#burn">Burn</a></h2>
<pre><code>constant &quot;Burn&quot; {
	EcFixedPoint VALUE_COMMIT_VALUE,
	EcFixedPoint VALUE_COMMIT_RANDOM,
	EcFixedPoint NULLIFIER_K,
}

contract &quot;Burn&quot; {
	Base secret,
	Base serial,
	MerklePath path,
	Base leaf,
	Base value,
	Base token,
	Scalar value_blind,
	Scalar token_blind,
	Base signature_secret,
}

circuit &quot;Burn&quot; {
	# Poseidon hash of the nullifier
	nullifier = poseidon_hash(secret, serial);
	constrain_instance(nullifier);

	# Merkle root
	root = calculate_merkle_root(path, leaf);
	constrain_instance(root);

	# Pedersen commitment for coin's value
	vcv = ec_mul_short(value, VALUE_COMMIT_VALUE);
	vcr = ec_mul(value_blind, VALUE_COMMIT_RANDOM);
	value_commit = ec_add(vcv, vcr);
	# Since value_commit is a curve point, we fetch its coordinates
	# and constrain them:
	value_commit_x = ec_get_x(value_commit);
	value_commit_y = ec_get_y(value_commit);
	constrain_instance(value_commit_x);
	constrain_instance(value_commit_y);

	# Pedersen commitment for coin's token ID
	tcv = ec_mul_short(token, VALUE_COMMIT_VALUE);
	tcr = ec_mul(token_blind, VALUE_COMMIT_RANDOM);
	token_commit = ec_add(tcv, tcr);
	# Since token_commit is also a curve point, we'll do the same
	# coordinate dance:
	token_commit_x = ec_get_x(token_commit);
	token_commit_y = ec_get_y(token_commit);
	constrain_instance(token_commit_x);
	constrain_instance(token_commit_y);

	# Finally, we derive a public key for the signature and
	# constrain its coordinates:
	signature_public = ec_mul(signature_secret, NULLIFIER_K);
	signature_x = ec_get_x(signature_public);
	signature_y = ec_get_y(signature_public);
	constrain_instance(signature_x);
	constrain_instance(signature_y);

	# At this point we've enforced all of our public inputs.
}
</code></pre>
<p>The <code>Burn</code> contract/circuit consists of operations similar to the
<code>Mint</code> circuit, with the addition of <em>Merkle root</em> calculation. In
the same manner, we're doing a Poseidon hash instance, we're building
Pedersen commitments for the value and token ID, and finally we're
doing a public key derivation.</p>
<p>In this case, our vector of public inputs could look like:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let public_inputs = vec![
    nullifier,
    *value_commitment_coords.x(),
    *value_commitment_coords.y(),
    *token_commitment_coords.x(),
    *token_commitment_coords.y(),
    merkle_root,
    *signature_coords.x(),
    *signature_coords.y(),
];
<span class="boring">}
</span></code></pre></pre>
<h3 id="nullifier"><a class="header" href="#nullifier">Nullifier</a></h3>
<p>When we spend the coin, we must ensure that the value of the coin
cannot be double spent. We call this the <em>Burn</em> phase. The process
relies on a nullifier <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>, which we create using the secret key <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>
for the public key <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> and a unique random serial <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ρ</span></span></span></span>. Nullifiers
are unique per coin and prevent double spending:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">ρ</span><span class="mclose">)</span></span></span></span></span></p>
<h3 id="value-and-token-commitments-1"><a class="header" href="#value-and-token-commitments-1">Value and Token commitments</a></h3>
<p>Just like we calculated these for the <code>Mint</code> contract, we do the same
here:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></span>
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<h3 id="public-key-derivation"><a class="header" href="#public-key-derivation">Public key derivation</a></h3>
<p>We check that the secret key <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> corresponds to a public key <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>.
Usually, we do public key derivation by multiplying our secret key
with a generator <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">G</span></span></span></span>, which results in a public key.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal">G</span></span></span></span></span></p>
<h3 id="merkle-root"><a class="header" href="#merkle-root">Merkle root</a></h3>
<p>We check that the merkle root corresponds to a coin which is in the
Merkle tree <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">ρ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span></span></p>
<p>Knowing this, we can extend our code example and build the
before-mentioned public inputs for the circuit:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let secret_key = pallas::Base::random(&amp;mut OsRng);
let serial = pallas::Base::random(&amp;mut OsRng);

let nullifier = poseidon::Hash(secret_key, serial);

let value = 42;
let token = 1;
let value_blind = pallas::Scalar::random(&amp;mut OsRng);
let token_blind = pallas::Scalar::random(&amp;mut OsRng);

let value_commit = pedersen_commitment_u64(value, valie_blind);
let value_coords = value_commit.to_affine().coordinates().unwrap();

let token_commit = pedersen_commitment_u64(token, token_blind);
let token_coords = token_commit.to_affine().coordinates().unwrap();

let tree = BridgeTree::&lt;MerkleNode, 32&gt;::new(100);
let some_coin_0 = pallas::Base::random(&amp;mut OsRng);
let some_coin_1 = pallas::Base::random(&amp;mut OsRng);
tree.append(some_coin_0);
tree.witness();
tree.append(some_coin_1);
tree.witness();

let merkle_root = tree.root();

let sig_secret = pallas::Base::random(&amp;mut OsRng);
let sig_public = OrchardFixedBases::NullifierK.generator() * mod_r_p(sig_secret);
let sig_coords = sig_public.to_affine().coordinates().unwrap();

let public_inputs = vec![
    nullifier,
    *value_commit_coords.x(),
    *value_commit_coords.y(),
    *token_commit_coords.x(),
    *token_commit_coords.y(),
    merkle_root,
    *sig_coords.x(),
    *sig_coords.y(),
];
<span class="boring">}
</span></code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
